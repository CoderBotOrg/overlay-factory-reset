#!/bin/bash
# create folder backup and signature
# put in /boot to backup raspberry boot partition
#

usage() {
	echo "backup_sign BACKUP_NAME [DEFAULT_KEY]"
	echo "backup current dir and creates DIRNAME.tar.xz and a DIRNAME.tar.xz.sig"
	exit 1
}

fail() {
	echo $1
	exit 2
}

BACKUP_DIR=.
FILENAME=${1}.tar.xz
SIGNAME=${1}.sig
DEF_KEY=$2

do_tar(){
	tar cfJv $FILENAME $BACKUP_DIR || fail "ERROR: could not create tar archive"
}

do_sign(){
	gpg --output $SIGNAME --default-key $DEF_KEY --detach-sign $FILENAME || fail "ERROR: could not sign file"
}	

do_tar

[ -z $DEF_KEY ] || do_sign

